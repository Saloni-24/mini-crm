{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Saloni\\\\OneDrive\\\\Desktop\\\\mini-crm\\\\mini-crm-frontend\\\\src\\\\context\\\\AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// src/context/AuthContext.js\nimport { createContext, useContext, useState, useEffect } from \"react\";\nimport { jwt_decode } from 'jwt-decode';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nlet logoutTimer = null;\nexport function AuthProvider({\n  children\n}) {\n  _s();\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [user, setUser] = useState(null);\n  const setLogoutTimer = exp => {\n    const expiryTimeInMs = exp * 1000 - Date.now();\n    if (expiryTimeInMs > 0) {\n      logoutTimer = setTimeout(() => {\n        logout();\n        alert(\"Session expired. Please log in again.\");\n      }, expiryTimeInMs);\n    }\n  };\n  const login = token => {\n    localStorage.setItem(\"token\", token);\n    const decoded = jwt_decode(token);\n    setUser(decoded);\n    setIsAuthenticated(true);\n    setLogoutTimer(decoded.exp); // setup auto logout\n  };\n  const logout = () => {\n    localStorage.removeItem(\"token\");\n    setUser(null);\n    setIsAuthenticated(false);\n    if (logoutTimer) clearTimeout(logoutTimer);\n  };\n  useEffect(() => {\n    const token = localStorage.getItem(\"token\");\n    if (token) {\n      try {\n        const decoded = jwtDecode(token);\n        if (decoded.exp * 1000 < Date.now()) {\n          logout(); // token already expired\n        } else {\n          setUser(decoded);\n          setIsAuthenticated(true);\n          setLogoutTimer(decoded.exp);\n        }\n      } catch (err) {\n        console.error(\"Invalid token\", err);\n        logout();\n      }\n    }\n    // eslint-disable-next-line\n  }, []);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      isAuthenticated,\n      login,\n      logout,\n      user\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 58,\n    columnNumber: 5\n  }, this);\n}\n_s(AuthProvider, \"Cix+uXOU60jwVTrRl9ss+REDA3M=\");\n_c = AuthProvider;\nexport function useAuth() {\n  _s2();\n  return useContext(AuthContext);\n}\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["createContext","useContext","useState","useEffect","jwt_decode","jsxDEV","_jsxDEV","AuthContext","logoutTimer","AuthProvider","children","_s","isAuthenticated","setIsAuthenticated","user","setUser","setLogoutTimer","exp","expiryTimeInMs","Date","now","setTimeout","logout","alert","login","token","localStorage","setItem","decoded","removeItem","clearTimeout","getItem","jwtDecode","err","console","error","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useAuth","_s2","$RefreshReg$"],"sources":["C:/Users/Saloni/OneDrive/Desktop/mini-crm/mini-crm-frontend/src/context/AuthContext.js"],"sourcesContent":["// src/context/AuthContext.js\r\nimport { createContext, useContext, useState, useEffect } from \"react\";\r\nimport {jwt_decode} from 'jwt-decode';\r\n\r\nconst AuthContext = createContext();\r\nlet logoutTimer = null;\r\n\r\nexport function AuthProvider({ children }) {\r\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\r\n  const [user, setUser] = useState(null);\r\n\r\n  const setLogoutTimer = (exp) => {\r\n    const expiryTimeInMs = exp * 1000 - Date.now();\r\n    if (expiryTimeInMs > 0) {\r\n      logoutTimer = setTimeout(() => {\r\n        logout();\r\n        alert(\"Session expired. Please log in again.\");\r\n      }, expiryTimeInMs);\r\n    }\r\n  };\r\n\r\n  const login = (token) => {\r\n    localStorage.setItem(\"token\", token);\r\n    const decoded = jwt_decode(token);\r\n    setUser(decoded);\r\n    setIsAuthenticated(true);\r\n    setLogoutTimer(decoded.exp); // setup auto logout\r\n  };\r\n\r\n  const logout = () => {\r\n    localStorage.removeItem(\"token\");\r\n    setUser(null);\r\n    setIsAuthenticated(false);\r\n    if (logoutTimer) clearTimeout(logoutTimer);\r\n  };\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem(\"token\");\r\n    if (token) {\r\n      try {\r\n        const decoded = jwtDecode(token);\r\n        if (decoded.exp * 1000 < Date.now()) {\r\n          logout(); // token already expired\r\n        } else {\r\n          setUser(decoded);\r\n          setIsAuthenticated(true);\r\n          setLogoutTimer(decoded.exp);\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Invalid token\", err);\r\n        logout();\r\n      }\r\n    }\r\n    // eslint-disable-next-line\r\n  }, []);\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ isAuthenticated, login, logout, user }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport function useAuth() {\r\n  return useContext(AuthContext);\r\n}\r\n"],"mappings":";;;AAAA;AACA,SAASA,aAAa,EAAEC,UAAU,EAAEC,QAAQ,EAAEC,SAAS,QAAQ,OAAO;AACtE,SAAQC,UAAU,QAAO,YAAY;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEtC,MAAMC,WAAW,gBAAGP,aAAa,CAAC,CAAC;AACnC,IAAIQ,WAAW,GAAG,IAAI;AAEtB,OAAO,SAASC,YAAYA,CAAC;EAAEC;AAAS,CAAC,EAAE;EAAAC,EAAA;EACzC,MAAM,CAACC,eAAe,EAAEC,kBAAkB,CAAC,GAAGX,QAAQ,CAAC,KAAK,CAAC;EAC7D,MAAM,CAACY,IAAI,EAAEC,OAAO,CAAC,GAAGb,QAAQ,CAAC,IAAI,CAAC;EAEtC,MAAMc,cAAc,GAAIC,GAAG,IAAK;IAC9B,MAAMC,cAAc,GAAGD,GAAG,GAAG,IAAI,GAAGE,IAAI,CAACC,GAAG,CAAC,CAAC;IAC9C,IAAIF,cAAc,GAAG,CAAC,EAAE;MACtBV,WAAW,GAAGa,UAAU,CAAC,MAAM;QAC7BC,MAAM,CAAC,CAAC;QACRC,KAAK,CAAC,uCAAuC,CAAC;MAChD,CAAC,EAAEL,cAAc,CAAC;IACpB;EACF,CAAC;EAED,MAAMM,KAAK,GAAIC,KAAK,IAAK;IACvBC,YAAY,CAACC,OAAO,CAAC,OAAO,EAAEF,KAAK,CAAC;IACpC,MAAMG,OAAO,GAAGxB,UAAU,CAACqB,KAAK,CAAC;IACjCV,OAAO,CAACa,OAAO,CAAC;IAChBf,kBAAkB,CAAC,IAAI,CAAC;IACxBG,cAAc,CAACY,OAAO,CAACX,GAAG,CAAC,CAAC,CAAC;EAC/B,CAAC;EAED,MAAMK,MAAM,GAAGA,CAAA,KAAM;IACnBI,YAAY,CAACG,UAAU,CAAC,OAAO,CAAC;IAChCd,OAAO,CAAC,IAAI,CAAC;IACbF,kBAAkB,CAAC,KAAK,CAAC;IACzB,IAAIL,WAAW,EAAEsB,YAAY,CAACtB,WAAW,CAAC;EAC5C,CAAC;EAEDL,SAAS,CAAC,MAAM;IACd,MAAMsB,KAAK,GAAGC,YAAY,CAACK,OAAO,CAAC,OAAO,CAAC;IAC3C,IAAIN,KAAK,EAAE;MACT,IAAI;QACF,MAAMG,OAAO,GAAGI,SAAS,CAACP,KAAK,CAAC;QAChC,IAAIG,OAAO,CAACX,GAAG,GAAG,IAAI,GAAGE,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE;UACnCE,MAAM,CAAC,CAAC,CAAC,CAAC;QACZ,CAAC,MAAM;UACLP,OAAO,CAACa,OAAO,CAAC;UAChBf,kBAAkB,CAAC,IAAI,CAAC;UACxBG,cAAc,CAACY,OAAO,CAACX,GAAG,CAAC;QAC7B;MACF,CAAC,CAAC,OAAOgB,GAAG,EAAE;QACZC,OAAO,CAACC,KAAK,CAAC,eAAe,EAAEF,GAAG,CAAC;QACnCX,MAAM,CAAC,CAAC;MACV;IACF;IACA;EACF,CAAC,EAAE,EAAE,CAAC;EAEN,oBACEhB,OAAA,CAACC,WAAW,CAAC6B,QAAQ;IAACC,KAAK,EAAE;MAAEzB,eAAe;MAAEY,KAAK;MAAEF,MAAM;MAAER;IAAK,CAAE;IAAAJ,QAAA,EACnEA;EAAQ;IAAA4B,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACW,CAAC;AAE3B;AAAC9B,EAAA,CAtDeF,YAAY;AAAAiC,EAAA,GAAZjC,YAAY;AAwD5B,OAAO,SAASkC,OAAOA,CAAA,EAAG;EAAAC,GAAA;EACxB,OAAO3C,UAAU,CAACM,WAAW,CAAC;AAChC;AAACqC,GAAA,CAFeD,OAAO;AAAA,IAAAD,EAAA;AAAAG,YAAA,CAAAH,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}